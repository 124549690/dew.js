/**
 * @author     LiuZhaoHui <hi.liuzhaoxin@gmail.com>
 * @link       http://www.eatbean.com/nodejs
**/

"use strict";

var http = require("http");
var HttpHandler = Dew("use", "Server.Web.HttpHandler");

var Bootstrap = 
{
    __name__ : "Bootstrap", 
    
    initialize : function (application)
    {
        application.addFromFile(__dirname + "/Web.json");
        
        HttpHandler.initialize(application);
    }, 
    
    run : function (application)
    {
        application.useSection("server");
        
        var svr = new http.createServer();
        svr.on("request", HttpHandler.processRequest.bind(HttpHandler));
        svr.on("listening", this.listening.bind(this, svr));
        svr.on("close", this.close.bind(this));
        svr.listen(application.get("port", 80), application.get("host", "0.0.0.0"));
    }, 
    
    listening : function (svr)
    {
        console.log("Http server running at " + svr.address().address + ":" + svr.address().port);
    }, 
    
    close : function ()
    {
        console.log("Http server closed");
    }
};

module.exports = Bootstrap;