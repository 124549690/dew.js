/**
 * @author     LiuZhaoHui <hi.liuzhaoxin@gmail.com>
 * @link       http://www.eatbean.com/nodejs
**/

"use strict";

var Protocol = Dew("use", "Server.Cache.Protocol");

var Connect = 
{
    __name__ : "Connect", 
    
    bootstrap : function (socket)
    {
        Object.create(this).run(socket);
    }, 
    
    run : function (socket)
    {
        this._socket = socket;
        this._address = socket.remoteAddress + ":" + socket.remotePort;
        
        socket.on("error", this.error.bind(this));
        socket.on("close", this.close.bind(this));
        
        //socket.write("welcome\n");
        console.log("TCP connection established from " + this._address);
        
        Protocol.initialize(socket);
    }, 
    
    error : function (exception)
    {
        console.log(JSON.stringify(exception));
        this._socket.end();
    }, 
    
    close : function ()
    {
        console.log("TCP connection closed from " + this._address); 
    }
};

module.exports = Connect;